<!DOCTYPE html>
<html>
<body>

<h2>JavaScript Strings</h2>

<p>The split() method splits a string into an array of substrings, and returns the array.</p>

<p id="demo"></p>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script>
var endpoint = "http://192.168.30.177:5000/rest/"
var uid = "6498c70394f8d772dce3779ae8abaaf3fb55f5c76cb8b614e077e4fa7f872938_4897"
var url = endpoint+"binary/"+uid
d3.json(url, function(data) {
    var b64 = data.binary
    const b64toBlob = (b64Data, contentType='', sliceSize=512) => {
    const byteCharacters = atob(b64Data);
    const byteArrays = [];

    for (let offset = 0; offset < byteCharacters.length; offset += sliceSize) {
        const slice = byteCharacters.slice(offset, offset + sliceSize);

        const byteNumbers = new Array(slice.length);
        for (let i = 0; i < slice.length; i++) {
        byteNumbers[i] = slice.charCodeAt(i);
        }

        const byteArray = new Uint8Array(byteNumbers);
        byteArrays.push(byteArray);
    }

    const blob = new Blob(byteArrays, {type: contentType});
    return blob;
    }
    const blob = b64toBlob(b64, "image/png");
    const blobUrl = URL.createObjectURL(blob);

    //window.location = blobUrl;
    // // Construct the <a> element
    var link = document.createElement("a");
    link.download = data.file_name
    link.href = blobUrl;

    document.body.appendChild(link);
    link.click();
})

</script>

</body>
</html>
